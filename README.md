# Аэротакси
Проект команды Human Express на проектной программе "Большие Вызовы"
## Суть проекта
//TODO
## Настройка коптеров
//TODO
## Настройка сервера
Чтобы скачать проект на сервер выполните команду 
```bash
git clone https://github.com/Tennessium/HUEX
``` 
Перед началом работы с системой необходимо подключить устройство к сети WiFi (например, раздать со смартфона) установить на него необходимые библиотеки
```bash
cd HUEX
pip install -r requirements.txt
```
В случае необходимости вы можете изменить высоту эшелонов в файле *server/consts.py* и настроить поле с метками в *server/static/map.txt*.
Теперь можно запустить сервер написав в командную строку
```bash
cd server
python manage.py runserver 0.0.0.0:8000
```
Чтобы перейти на веб страницу наберите в адресной строке ip адрес сервера в локальной сети и укажите порт 8000.
[Как узнать ip адрес устройства](https://remontka.pro/ip-adres/)
## Центр управления полётами
<img src="media/cup.PNG" alt=""/>
В данном веб интерфейче можно следить за полётами всех дронов на карте (масштабировать с помощью колёсика, передвигаять с помощью *Alt*). При нажатии на лебедя в правом верхнем углу все коптеры аварийно садятся, А при нажатии на значок "обновить" все коптеры автоматически удаляются, что приводит к удалению всех комманд и посадке активных на текущий момент коптеров.
С помощью инструментов в правом нижнем углу можно строить новые основания и рёбра. 

## API
На случай если вы захотите реализовать свою "обёртку" вы можете реализовать взаимодействие с сервером по средствам *HTTP/HTTPS* запросов
### /get
Возвращает телеметрию всех доступных коптеров.
Пример:
```json
{
  "message": "OK",
  "drones": [
    {
      "ip": "192.168.1.101",
      "led": "#FF0000",
      "status": "land",
      "pose": {
        "x": 0.24,
        "y": 0.38,
        "z": 0,
        "yaw": 0
      },
      "voltage": 4.12,
      "nextp": {
        "led": "#FF0000",
        "status": "land",
        "pose": {
          "x": 0.24,
          "y": 0.38,
          "z": 1.5,
          "yaw": 0
        }
      }
    }
  ]
}
```
Где 
 - **ip** - ip адрес коптера
 - **led** - цвет светодиодной ленты
 - **status** - *fly* или *land* - текущий статус коптера
 - **pose** - позиция коптера (*x*, *y*, *z*,  и *yaw*)
 - **voltage** - напряжение на одной банке
 - **nextp** - отдаваемая коптеру команда на полёт (*led*, *status*, *pose* как выше)
### /static/roads.json
Текущая карта дорог первого эшелона
Пример:
```json
{
  "points": [
    {
      "x": 2.1,
      "y": 3.5
    },
    {
      "x": 0.6,
      "y": 0.4
    },
    {
      "x": 2.4,
      "y": 0.5
    }
  ],
  "lines": [
    {
      "1": 2,
      "2": 1
    },
    {
      "1": 1,
      "2": 0
    }
  ]
}
```
Где
 - **poits** - массив вершин графа и их координат
 - **lines** - массив рёбер графа (*1* - точка из которой выходит ребро, *2* - точка куда это ребро направлено)
### /ask_taxi?o=x&t=y
Заказ такси из точки под номером *x* в точку под номером *y*. Точки *x* и *y* берутся  из **/static/roads.json**
### /get_dist?o=x&t=y
Возвращает расстояние и цену за пролёт между точками. 
Пример:
```json
{"dist": 5.3, "cost": 309}
```
Где 
 - **dist** - Дистанция в метрах
 - **cost** - Цена в рублях (150₽ + 30₽ * *n* метров) 
